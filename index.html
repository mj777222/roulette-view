--- START OF FILE index.html ---

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë£°ë › í†µê³„ í˜„í™©</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #FFD700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px #000000;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            background-color: #2a2a2a;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            font-size: 14px;
        }

        .stats-table th, .stats-table td {
            border: 1px solid #444;
            padding: 10px 8px;
            text-align: center;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .stats-table th {
            background-color: #333;
            color: #00d26a; /* ì¹˜ì§€ì§ ê·¸ë¦° */
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* ë‹‰ë„¤ì„ ì—´ ê°•ì¡° */
        .stats-table td:first-child {
            font-weight: bold;
            color: #FFD700;
        }

        /* ì²œì¥ ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .status-low { color: #aaa; }           /* ì²œì¥ë¯¸ë‹¬ */
        .status-mid { color: #00d26a; font-weight: bold; } /* ì¶”ì²œê²Œì„ */
        .status-high { color: #ff5555; font-weight: bold; animation: pulse 2s infinite; } /* ë¦¬í€˜ìŠ¤íŠ¸ */

        /* 0ê°œì¼ ë•Œ íë¦¬ê²Œ ì²˜ë¦¬ */
        .count-zero { color: #555; }
        .count-value { color: #fff; font-weight: bold; }

        @keyframes pulse {
            0% { text-shadow: 0 0 5px #ff5555; }
            50% { text-shadow: 0 0 15px #ff5555; }
            100% { text-shadow: 0 0 5px #ff5555; }
        }
    </style>
</head>
<body>

    <h1>ğŸ“Š ìœ ì €ë³„ ë£°ë › í†µê³„ & ì²œì¥ í˜„í™©</h1>
    <div id="table-container">ë°ì´í„° ë¡œë”© ì¤‘...</div>

    <script>
        // =========================================================
        // [ì¤‘ìš”] ì—¬ê¸°ì— ë³¸ì¸ì˜ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”
        const SHEET_ID = "1r3P3kwK51SAOzgTu-v0RtY0CliZ7JcWfzgarOdedql0"; 
        // =========================================================

        const API_URL = `https://opensheet.elk.sh/${SHEET_ID}/1`;

        async function loadData() {
            try {
                const response = await fetch(API_URL);
                const rawData = await response.json();

                // ë°ì´í„° ê°€ê³µ (ìœ ì €ë³„ ì§‘ê³„)
                const userStats = {};
                const allRewards = new Set(); // ë“±ì¥í•œ ëª¨ë“  ë³´ìƒ ëª©ë¡

                rawData.forEach(row => {
                    const nickname = row['ë‹‰ë„¤ì„'];
                    const reward = row['ë³´ìƒ'];
                    
                    if (!nickname || !reward) return;

                    // ìœ ì € ë°ì´í„° ì´ˆê¸°í™”
                    if (!userStats[nickname]) {
                        userStats[nickname] = {
                            totalSpins: 0,
                            rewards: {}
                        };
                    }

                    // ì¹´ìš´íŠ¸ ì¦ê°€
                    userStats[nickname].totalSpins += 1;
                    userStats[nickname].rewards[reward] = (userStats[nickname].rewards[reward] || 0) + 1;
                    
                    // ë³´ìƒ ëª©ë¡ì— ì¶”ê°€ (ì• êµê¶Œë„ í¬í•¨ë¨)
                    allRewards.add(reward);
                });

                // ë³´ìƒ ëª©ë¡ ì •ë ¬ ë¡œì§ (ìš”ì²­: ë§¤ë„ê¶Œ -> ì• êµê¶Œ -> ë°°ë°•ìˆ˜)
                const customOrder = ["ë§¤ë„ê¶Œ", "ì• êµê¶Œ", "ë°°ë°•ìˆ˜"];
                
                const rewardList = Array.from(allRewards).sort((a, b) => {
                    const idxA = customOrder.indexOf(a);
                    const idxB = customOrder.indexOf(b);

                    // ë‘˜ ë‹¤ ì»¤ìŠ¤í…€ ì˜¤ë”ì— ìˆìœ¼ë©´ ì§€ì •ëœ ìˆœì„œëŒ€ë¡œ
                    if (idxA !== -1 && idxB !== -1) return idxA - idxB;
                    // aë§Œ ìˆìœ¼ë©´ ì•ìœ¼ë¡œ
                    if (idxA !== -1) return -1;
                    // bë§Œ ìˆìœ¼ë©´ ì•ìœ¼ë¡œ
                    if (idxB !== -1) return 1;

                    // ë‚˜ë¨¸ì§€ëŠ” ê°€ë‚˜ë‹¤ìˆœ
                    return a.localeCompare(b);
                });

                // í…Œì´ë¸” ìƒì„±
                let html = `<table class="stats-table">`;
                
                // 1. í…Œì´ë¸” í—¤ë” ìƒì„±
                html += `<thead><tr>
                            <th style="width: 15%;">ë‹‰ë„¤ì„</th>
                            <th style="width: 15%;">ì²œì¥ ì—¬ë¶€ (íšŸìˆ˜)</th>`;
                
                rewardList.forEach(r => {
                    html += `<th>${r}</th>`;
                });
                html += `</tr></thead><tbody>`;

                // 2. í…Œì´ë¸” ë³¸ë¬¸ ìƒì„± (ë§ì´ ëŒë¦° ìˆœìœ¼ë¡œ ì •ë ¬)
                const sortedUsers = Object.keys(userStats).sort((a, b) => {
                    return userStats[b].totalSpins - userStats[a].totalSpins;
                });

                sortedUsers.forEach(user => {
                    const stats = userStats[user];
                    const count = stats.totalSpins;
                    
                    // ì²œì¥ ë¡œì§ ì ìš© (í…ìŠ¤íŠ¸ ìˆ˜ì •: ì¶”ì²œê²Œì„ -> ì¶”ì²œ ê²Œì„)
                    let statusText = "ì²œì¥ë¯¸ë‹¬";
                    let statusClass = "status-low";

                    if (count >= 150) {
                        statusText = "ğŸ”¥ ë¦¬í€˜ìŠ¤íŠ¸";
                        statusClass = "status-high";
                    } else if (count >= 100) {
                        statusText = "âœ… ì¶”ì²œ ê²Œì„";
                        statusClass = "status-mid";
                    }

                    html += `<tr>
                                <td>${user}</td>
                                <td>
                                    <span class="${statusClass}">${statusText}</span><br>
                                    <span style="font-size:0.8em; color:#888;">(${count}íšŒ)</span>
                                </td>`;

                    // ê° ë³´ìƒë³„ ê°œìˆ˜ ì¶œë ¥
                    rewardList.forEach(rewardName => {
                        const rewardCount = stats.rewards[rewardName] || 0;
                        const countClass = rewardCount === 0 ? "count-zero" : "count-value";
                        html += `<td class="${countClass}">${rewardCount}</td>`;
                    });

                    html += `</tr>`;
                });

                html += `</tbody></table>`;
                
                document.getElementById('table-container').innerHTML = html;

            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                document.getElementById('table-container').innerHTML = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì‹œíŠ¸ IDë‚˜ ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.";
            }
        }

        // 5ì´ˆë§ˆë‹¤ ë°ì´í„° ê°±ì‹ 
        setInterval(loadData, 5000);
        loadData();
    </script>
</body>
</html>
