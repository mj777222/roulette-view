<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë£°ë › í†µê³„ í˜„í™©</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #FFD700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px #000000;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            background-color: #2a2a2a;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            font-size: 13px; /* ì»¬ëŸ¼ì´ ë§ì•„ì ¸ì„œ ê¸€ì í¬ê¸° ì•½ê°„ ì¡°ì • */
        }

        .stats-table th, .stats-table td {
            border: 1px solid #444;
            padding: 8px 5px;
            text-align: center;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .stats-table th {
            background-color: #333;
            color: #00d26a; /* ì¹˜ì§€ì§ ê·¸ë¦° */
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap; /* í—¤ë” ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        /* ë‹‰ë„¤ì„ ì—´ ê°•ì¡° */
        .stats-table td:first-child {
            font-weight: bold;
            color: #FFD700;
            min-width: 80px;
        }

        /* ì²œì¥ ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .status-low { color: #888; font-size: 0.9em; }           /* ì²œì¥ë¯¸ë‹¬ */
        .status-mid { color: #00d26a; font-weight: bold; }       /* ì¶”ì²œ ê²Œì„ */
        .status-high { color: #ff5555; font-weight: bold; animation: pulse 2s infinite; } /* ë¦¬í€˜ìŠ¤íŠ¸ */

        /* 0ê°œì¼ ë•Œ íë¦¬ê²Œ ì²˜ë¦¬ */
        .count-zero { color: #444; }
        .count-value { color: #fff; font-weight: bold; font-size: 1.1em; }

        @keyframes pulse {
            0% { text-shadow: 0 0 5px #ff5555; }
            50% { text-shadow: 0 0 15px #ff5555; }
            100% { text-shadow: 0 0 5px #ff5555; }
        }
    </style>
</head>
<body>

    <h1>ğŸ“Š ìœ ì €ë³„ ë£°ë › í†µê³„</h1>
    <div id="table-container" style="overflow-x: auto;">ë°ì´í„° ë¡œë”© ì¤‘...</div>

    <script>
        // =========================================================
        // [ì¤‘ìš”] ì—¬ê¸°ì— ë³¸ì¸ì˜ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”
        const SHEET_ID = "1r3P3kwK51SAOzgTu-v0RtY0CliZ7JcWfzgarOdedql0"; 
        // =========================================================

        const API_URL = `https://opensheet.elk.sh/${SHEET_ID}/1`;

        // [ì„¤ì •] í‘œê¸°í•  ë³´ìƒ ëª©ë¡ ë° ìˆœì„œ (ì´ë¦„ì´ ì—‘ì…€ê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨)
        // ìˆ˜ì •ë¨: 'ì¶”ì²œ ê²Œì„' ë„ì–´ì“°ê¸° ë°˜ì˜, 'ì• êµê¶Œ' ì¶”ê°€ (ë§¤ë„ê¶Œê³¼ ë°°ë°•ìˆ˜ ì‚¬ì´)
        const TARGET_REWARDS = [
            "ì»¤ë¯¸ì…˜ 30% í• ì¸ê¶Œ",
            "ë¦¬í€˜ìŠ¤íŠ¸ ì¿ í°",
            "ì¶”ì²œ ê²Œì„",
            "ê²‰ì˜· 1ì¼ ë²—ê¸°",
            "ê²‰ì˜· 30ë¶„ ë²—ê¸°",
            "ë§¤ë„ê¶Œ",
            "ì• êµê¶Œ",
            "ë°°ë°•ìˆ˜",
            "ì´‰ìŠˆê¶Œ 10ë¶„"
        ];

        async function loadData() {
            try {
                const response = await fetch(API_URL);
                const rawData = await response.json();

                // ë°ì´í„° ê°€ê³µ (ìœ ì €ë³„ ì§‘ê³„)
                const userStats = {};

                rawData.forEach(row => {
                    const nickname = row['ë‹‰ë„¤ì„'];
                    let reward = row['ë³´ìƒ']; // ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ let ì‚¬ìš©
                    
                    if (!nickname || !reward) return;

                    // [ë°ì´í„° ì •ê·œí™”]
                    // 1. ê³µë°± ì œê±° í›„ ë¹„êµí•˜ì—¬ "ì¶”ì²œê²Œì„"ì„ "ì¶”ì²œ ê²Œì„"ìœ¼ë¡œ í†µì¼
                    // (ê³¼ê±° ë°ì´í„° í˜¸í™˜ì„± ë° ìµœì‹  ë°ì´í„° ë°˜ì˜)
                    if (reward.replace(/\s+/g, '') === 'ì¶”ì²œê²Œì„') {
                        reward = 'ì¶”ì²œ ê²Œì„';
                    }

                    // ìœ ì € ë°ì´í„° ì´ˆê¸°í™”
                    if (!userStats[nickname]) {
                        userStats[nickname] = {
                            totalSpins: 0, // ì²œì¥ ê³„ì‚°ìš© ì „ì²´ íšŸìˆ˜
                            rewards: {}    // ë³´ìƒë³„ ê°œìˆ˜ ì €ì¥
                        };
                    }

                    // ì „ì²´ íšŸìˆ˜ ì¦ê°€ (ì²œì¥ ë“±ê¸‰ íŒë³„ìš©)
                    userStats[nickname].totalSpins += 1;

                    // ë³´ìƒ ê°œìˆ˜ ì¹´ìš´íŠ¸
                    userStats[nickname].rewards[reward] = (userStats[nickname].rewards[reward] || 0) + 1;
                });

                // í…Œì´ë¸” ìƒì„± ì‹œì‘
                let html = `<table class="stats-table">`;
                
                // 1. í…Œì´ë¸” í—¤ë” ìƒì„± (ê³ ì •ëœ ìˆœì„œ ì ìš©)
                html += `<thead><tr>
                            <th style="width: 10%;">ë‹‰ë„¤ì„</th>
                            <th style="width: 10%;">ì²œì¥ ì—¬ë¶€</th>`;
                
                // ì§€ì •ëœ ë³´ìƒ ëª©ë¡ëŒ€ë¡œ í—¤ë” ìƒì„±
                TARGET_REWARDS.forEach(r => {
                    html += `<th>${r}</th>`;
                });
                html += `</tr></thead><tbody>`;

                // 2. í…Œì´ë¸” ë³¸ë¬¸ ìƒì„± (ë§ì´ ëŒë¦° ìˆœìœ¼ë¡œ ì •ë ¬)
                const sortedUsers = Object.keys(userStats).sort((a, b) => {
                    return userStats[b].totalSpins - userStats[a].totalSpins;
                });

                sortedUsers.forEach(user => {
                    const stats = userStats[user];
                    const count = stats.totalSpins;
                    
                    // ì²œì¥ ë¡œì§ ì ìš© (100ë¯¸ë§Œ / 100~149 / 150ì´ìƒ)
                    let statusText = "ì²œì¥ë¯¸ë‹¬";
                    let statusClass = "status-low";

                    if (count >= 150) {
                        statusText = "ë¦¬í€˜ìŠ¤íŠ¸";
                        statusClass = "status-high";
                    } else if (count >= 100) {
                        statusText = "ì¶”ì²œ ê²Œì„"; // í…ìŠ¤íŠ¸ í†µì¼
                        statusClass = "status-mid";
                    }
                    // ì²œì¥ë¯¸ë‹¬ì€ ê·¸ëŒ€ë¡œ ìœ ì§€

                    html += `<tr>
                                <td>${user}</td>
                                <td>
                                    <span class="${statusClass}">${statusText}</span>
                                    <!-- íšŸìˆ˜ í‘œê¸° ì‚­ì œë¨ -->
                                </td>`;

                    // ì§€ì •ëœ ë³´ìƒ ìˆœì„œëŒ€ë¡œ ê°œìˆ˜ ì¶œë ¥
                    TARGET_REWARDS.forEach(rewardName => {
                        // í•´ë‹¹ ë³´ìƒì´ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì²˜ë¦¬
                        const rewardCount = stats.rewards[rewardName] || 0;
                        const countClass = rewardCount === 0 ? "count-zero" : "count-value";
                        html += `<td class="${countClass}">${rewardCount}</td>`;
                    });

                    html += `</tr>`;
                });

                html += `</tbody></table>`;
                
                document.getElementById('table-container').innerHTML = html;

            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                document.getElementById('table-container').innerHTML = `<p style="text-align:center; color:red;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨.<br>ì‹œíŠ¸ IDë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>`;
            }
        }

        // 5ì´ˆë§ˆë‹¤ ë°ì´í„° ê°±ì‹ 
        setInterval(loadData, 5000);
        loadData();
    </script>
</body>
</html>
